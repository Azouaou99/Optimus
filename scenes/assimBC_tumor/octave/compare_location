# load error rate data
groundTruthData = fopen("/home/sergei/Source_code/Sofa_development/Optimus/scenes/assimBC_tumor/observations/brickD_ogrid4/tumorGroundTruthPos_x.txt");
initialData = fopen("/home/sergei/Source_code/Sofa_development/Optimus/scenes/assimBC_tumor/observations/brickD_ogrid4/tumorInitialPos_x.txt");
correctedData = fopen("/home/sergei/Source_code/Sofa_development/Optimus/scenes/assimBC_tumor/observations/brickD_ogrid4/tumorCorrectedPos_x.txt");

### read ground truth data
groundTruthValues = [];
timeLine = [];

# skip first two lines
currentLine = fgets(groundTruthData);
currentLine = fgets(groundTruthData);

while (!feof(groundTruthData))
    currentLine = fgets(groundTruthData);
    tokens = strsplit(currentLine);
    time = tokens(1,1);
    timeLine = [timeLine str2double(time)];

    dataLine = [];
    index = 2;
    while (index < size(tokens,2))
        dataLine = [dataLine str2double(tokens(1,index))];
        index = index + 1;
    endwhile
    groundTruthValues = [groundTruthValues; dataLine];
endwhile
fclose(groundTruthData);



### read initial data
initialValues = [];

# skip first two lines
currentLine = fgets(initialData);
currentLine = fgets(initialData);

while (!feof(initialData))
    currentLine = fgets(initialData);
    tokens = strsplit(currentLine);
    
    dataLine = [];
    index = 2;
    while (index < size(tokens,2))
        dataLine = [dataLine str2double(tokens(1,index))];
        index = index + 1;
    endwhile
    initialValues = [initialValues; dataLine];
endwhile
fclose(initialData);



### read corrected data
correctedValues = [];

# skip first two lines
currentLine = fgets(correctedData);
currentLine = fgets(correctedData);

while (!feof(correctedData))
    currentLine = fgets(correctedData);
    tokens = strsplit(currentLine);
    
    dataLine = [];
    index = 2;
    while (index < size(tokens,2))
        dataLine = [dataLine str2double(tokens(1,index))];
        index = index + 1;
    endwhile
    correctedValues = [correctedValues; dataLine];
endwhile
fclose(correctedData);



### compute average difference
initialAverageLine = [];
correctedAverageLine = [];

loopIndex = min(size(groundTruthValues, 1), min(size(initialValues, 1), size(correctedValues, 1)));
timeLine = timeLine(:, 1:loopIndex);
for index = 1:loopIndex
    initialAverage = 0;
    correctedAverage = 0;
    for internalIndex = 1:size(groundTruthValues, 2)
        diff = initialValues(index, internalIndex) - groundTruthValues(index, internalIndex);
        initialAverage = initialAverage + diff*diff;
        diff = correctedValues(index, internalIndex) - groundTruthValues(index, internalIndex);
        correctedAverage = correctedAverage + diff*diff;
    endfor

    initialAverage = initialAverage / size(groundTruthValues, 2);
    initialAverageLine = [initialAverageLine initialAverage];

    correctedAverage = correctedAverage / size(groundTruthValues, 2);
    correctedAverageLine = [correctedAverageLine correctedAverage];
endfor

### plot data
figure(1),
init = plot(timeLine, initialAverageLine, '-', "color", "red", "linewidth", 4);
hold on;
corr = plot(timeLine, correctedAverageLine, '-', "color", "green", "linewidth", 4);
legend ([init corr], "initial values", "corrected values");
title("average difference error for tumor rate", "fontsize", 36);
hold off;


